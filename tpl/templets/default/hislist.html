<ul class="list-box">
    <!--{foreach $data as $list}-->
    <li class="list-box__item">
        <a class="list-box__item-wrap" href1='<!--{if $list.type==1}-->
                    <!--{url mod="book" args="bookid:{$list.book_id},title:{$list.other_name},on:{$list.watch_sec}"}-->
                    <!--{else}--> <!--{url mod="cartoon" args="bookid:{$list.book_id},title:{$list.other_name},on:{$list.watch_sec}"}-->
                    <!--{/if}-->' title="<!--{$list.other_name}-->" data-id='<!--{$list.his_id}-->'>
            <div class="list-box__item-left"><img src="<!--{$indextpl}-->imgs/space.gif"
                    alt=" <!--{$list.other_name}-->" class="list-box__item-cover"
                    style="background: url(' <!--{$list.bpic}-->') center center / cover no-repeat; opacity: 1;">
            </div>
            <div class="list-box__item-center">
                <p class="list-box__item-title">
                    <!--{$list.other_name}-->
                </p>
                <p class="list-box__item-desc">
                    <!--{$list.desc}-->
                </p>
                <div class="list-box__item-hot"><span class="yi">
                        <!--{$list.watch_time|date_format:"%m/%d"}-->
                    </span>
                    <span>

                    </span>
                </div>

            </div>
            <div class="list-box__item-right">
                <div class="list-box__item-collection"><span class="btn-sub subscribe">
                        <!--{__ 删除}-->
                    </span></div>
            </div>
        </a>
    </li>
    <!--{/foreach}-->

    <div class="bottom_">
        <div class="flexCenter-ai-center">

            <div class="loadimg">
                <img src="<!--{$indextpl}-->imgs/loading-2.gif">
                <!--{__ 加载中}-->...
            </div>
            <div class="loadend">

                <!--{__ 没有了}-->
            </div>
        </div>

    </div>
</ul>
<div class="bookboxtmp">
    <li class="list-box__item">
        <a class="list-box__item-wrap" href1='<!--{if $list.type==1}-->
                    <!--{url mod="book" args="bookid:{$list.book_id},title:{$list.other_name}"}-->
                    <!--{else}--> <!--{url mod="cartoon" args="bookid:{$list.book_id},title:{$list.other_name}"}-->
                    <!--{/if}-->' title="<!--{$list.other_name}-->">
            <div class="list-box__item-left"><img src="<!--{$indextpl}-->imgs/space.gif"
                    alt=" <!--{$list.other_name}-->" class="list-box__item-cover"
                    style="background: url(' <!--{$list.bpic}-->') center center / cover no-repeat; opacity: 1;">
            </div>
            <div class="list-box__item-center">
                <p class="list-box__item-title">
                    <!--{$list.other_name}-->
                </p>
                <p class="list-box__item-desc">
                    <!--{$list.desc}-->
                </p>
                <div class="list-box__item-hot"><span class="yi">
                        <!--{$list.watch_time|date_format:"%Y-%m-%d %H:%M:%S"}-->
                    </span>
                    <span>

                    </span>
                </div>

            </div>
            <div class="list-box__item-right">
                <div class="list-box__item-collection"><span class="btn-sub subscribe">
                        <!--{__ 删除}-->
                    </span></div>
            </div>
        </a>
    </li>
</div>
</section>

<style>
    .loadimg {
        display: none;
    }

    .header-wrap {
        -webkit-box-shadow: 0 0 0.2666666667rem 0 rgba(0, 0, 0, .2);
        -moz-box-shadow: 0 0 .2666666667rem 0 rgba(0, 0, 0, .2);
        box-shadow: 0 0 0.2666666667rem 0 rgba(0, 0, 0, .2);
        background-color: #fff;
        /* -webkit-transition: all .4s; */
        -o-transition: all .4s;
        -moz-transition: all .4s;
        transition: all .4s;
    }

    .loadend {
        display: none;
    }

    .bookboxtmp {
        display: none;
    }

    .flexCenter-ai-center {
        display: flex;
        align-content: center;
        width: 100%;
        align-items: center;
        justify-items: center;
        justify-content: center;
        margin: 0.3rem 0;
        color: #ccc;
    }

    .flexCenter-ai-center img {
        width: 20%;
    }

    .list-box {
        position: relative;
        width: 100%;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        padding: 0 .4266666667rem;
        display: block;
        overflow: scroll;
        padding-bottom: 2rem;
    }

    .list-box .list-box__item {
        height: 2.9866666667rem;
        margin-top: .64rem;
        position: relative
    }

    .list-box .list-box__item:last-child {
        margin-bottom: .64rem
    }

    .list-box .list-box__item-wrap {
        display: -webkit-box;
        display: -webkit-flex;
        display: -moz-box;
        display: -ms-flexbox;
        display: flex
    }

    .list-box .list-box__item-cover {
        -webkit-border-radius: .1066666667rem;
        -moz-border-radius: .1066666667rem;
        border-radius: .1066666667rem;
        width: 2.24rem;
        height: 2.9866666667rem
    }

    .list-box .list-box__item-left {
        margin-right: .32rem
    }

    .list-box .list-box__item-center {
        width: 4.8rem;
        margin-right: .32rem
    }

    .list-box .list-box__item-right {
        position: absolute;
        top: 50%;
        right: 0;
        -webkit-transform: translateY(-50%);
        -moz-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        transform: translateY(-50%)
    }

    .list-box .list-box__item-title {
        font-size: .4533333333rem;
        margin-top: .16rem;
        color: #333
    }

    .list-box .list-box__item-desc,
    .list-box .list-box__item-title {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .list-box .list-box__item-desc {
        margin-top: .1066666667rem;
        font-size: .33rem;
        line-height: .52rem;
        color: #b6b6b6;
        height: 1.5933333333rem;
    }

    .list-box .list-box__item-hot {
        margin-top: .1066666667rem;
        color: #b6b6b6;
        font-size: .2666666667rem
    }

    .list-box .list-box__item-hot .ift-fire {
        font-size: .2933333333rem;
        margin-right: .0533333333rem
    }

    .list-box .list-box__item-hot span {
        vertical-align: bottom
    }

    .list-box .list-box__item-tag {
        margin-top: .24rem;
        font-size: .2666666667rem;
        color: #b6b6b6
    }

    .list-box .list-box__item-tag-item {
        border: .0133333333rem solid #b6b6b6;
        -webkit-border-radius: .1866666667rem;
        -moz-border-radius: .1866666667rem;
        border-radius: .1866666667rem;
        font-size: .2666666667rem;
        padding: .0266666667rem .08rem;
        margin: .0266666667rem
    }

    .list-box .list-box__item-collection {
        width: 1.4933333333rem;
        height: .64rem;
        line-height: .64rem;
        -webkit-border-radius: .32rem;
        -moz-border-radius: .32rem;
        border-radius: .32rem;
        background: #fc6976;
        color: #fff;
        text-align: center
    }

    .list-box .list-box__item-collection.done {
        background: #f5f5f5;
        color: #999
    }

    .list-box .list-box__item-collection.done .ift-add {
        display: none
    }
</style>

<script>
    //初始化banner高度，宽高比。0.73
    var searchindex = 'searchhis';
    var searchdata, page = 1, have = 1, loadings = 0;
    var searurl = '<!--{url mod="search"}-->?word=';
    Array.prototype.aremove = function (val) {
        var index = this.indexOf(val);
        if (index > -1) {
            this.splice(index, 1);
        }
    };
    function pgscroll() {
        $('.bookrack-content').scroll(function () {
            var scrollTop = $(this).scrollTop();

            var ks_area = $(this).innerHeight();

            //滚动距离总长(注意不是滚动条的长度)  
            nScrollHight = $('body')[0].scrollHeight;
            if (scrollTop + ks_area >= (nScrollHight - 1 * $(window).height())) {
                loading();
            }
            if (scrollTop + ks_area >= nScrollHight) {
                loading();
                showloadbox();
            }
            if ($(this).scrollTop() == 0) {
            }
        });
    }
    function loading() {

        if (!have) return false;
        if (loadings) return false;

        // $word = $('.search-area').val();
        // if (!$word) return false;
        loadings = 1;

        $url = '';
        $data = {
            'page': page++,
            'ajax': 1
            // 'keyword': $word
        };
        yAjax($url, $data, function ($ret) {
            loadings = 0;
            if ($ret['code'] == 1) {
                $books = $ret['result'];
                if ($books.length <= 0) {
                    have = 0;
                    //变更加载状态
                    showloadbox();
                } else {
                    //加载
                    $d = $('.bottom_');
                    $urlbook = "<!--{url mod='book'}-->?bookid=";
                    $urlcartoon = "<!--{url mod='cartoon'}-->?bookid=";
                    $.each($books, function (i, book) {
                        $obj = $('.bookboxtmp').find('.list-box__item').clone();
                        $obj.find('.list-box__item-left>img').attr('src', book.bpic);
                        $obj.find('.list-box__item-desc').text(book.desc);
                        $obj.find('.list-box__item-title').text(book.other_name);
                        $obj.find('.yi').text(ftime(book.watch_time));

                        if (book.type == 1) {
                            $url = $urlbook + book.book_id + "&on=" + book.watch_sec;
                        } else {
                            $url = $urlcartoon + book.book_id + "&on=" + book.watch_sec;
                        }
                        $obj.find('a').attr('href1', $url);
                        $obj.find('a').attr('data-id', book.his_id);
                        $d.before($obj);
                    });
                }
            } else {
                showd('error' + $ret['code']);
            }
        });
    }
    function showloadbox() {
        if (have) {
            $('.loadimg').show();
            $('.loadend').hide();
        } else {
            $('.loadimg').hide();
            $('.loadend').show();
        }
    }
    function ftime($t) {
        var now = new Date(parseInt($t) * 1000);
        // d(now);
        // d(now);
        var year = now.getFullYear();

        var month = now.getMonth() + 1;
        var date = now.getDate();
        return month + "/" + date;
    }
    $(function () {

        pgscroll();
        $('.js_searchBtn').on('click', function () {

            $txt = $('.search-area').val();
            if (!$txt) {
                _go_url(searurl);
                // showd('<!--{__ 请输入查找内容}-->');
                return false;
            }

            if (searchdata.indexOf($txt) < 0) {

                searchdata.push($txt);
                save(searchdata);

            }
            loadhis(searchdata);
            _go_url(searurl + $txt);
        });
        $('.historyDel').on('click', function () {
            d('del');
            seardel($(this));
            // loadhis(searchdata);
        });
        $('.historyClear').on('click', function () {

            delCookie(searchindex);
            searchdata = [];

            loadhis(searchdata);
        });
        $('.history-text').on('click', function () { });
        $('#enter').on('keydown', function (event) {
            if (event.keyCode == 13) {
                $('.js_searchBtn').click();
            }

        });
    });
    function save(val) {
        // val = encodeURIComponent(val);

        $in = atj(val);

        // $in.replace(/%/g, '%25');

        setCookie(searchindex, $in);
    }
    function seardel($obj) {
        $txt = $obj.attr('data-searched');
        $ob = $obj.parentsUntil('li');
        $ob.parent().remove();
        searchdata.aremove($txt);
        setCookie(searchindex, searchdata);
        save(searchdata);
    }
    function loadhis(his) {
        $obj = $('.tmpSrch').children('li');
        $obj2 = $('.hisSrch-list');
        $obj2.children().remove();
        if (!his) {

            $('.hisSrch').hide();
            return false;
        } else {

            if (his.length <= 0) {

                $('.hisSrch').hide();
                return false;
            }
            $('.hisSrch').show();

            $.each(his, function (i, v) {
                $obj3 = $obj.clone();
                $obj3.find('.history-text').text(v);
                $obj3.find('.historyDel').attr('data-searched', v);
                $obj3.find('a').attr('title', v);
                $obj3.find('a').attr('href', searurl + v);
                $obj2.prepend($obj3);
            });
        }

    }
</script>